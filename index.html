<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>LumoAI - Chat Application</title>
    <meta name="description" content="LumoAI - A playful AI chat companion" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --background: hsl(0 0% 0%);
            --foreground: hsl(200 6.6667% 91.1765%);
            --card: hsl(228 9.8039% 10%);
            --border: hsl(210 5.2632% 14.9020%);
            --muted: hsl(0 0% 9.4118%);
            --muted-foreground: hsl(210 3.3898% 46.2745%);
            --primary: hsl(203.7736 87.6033% 52.5490%);
        }
        html, body { height: 100%; width: 100%; font-family: "Open Sans", sans-serif; background-color: var(--background); color: var(--foreground); }
        body { display: flex; flex-direction: column; }
        .app-container { display: flex; flex-direction: column; height: 100vh; background-color: var(--background); }

        header { border-bottom: 1px solid var(--border); background-color: var(--background); padding: 1.5rem; }
        header h1 { font-size: 1.5rem; font-weight: 600; color: var(--foreground); }

        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; padding: 1.5rem; }

        .messages-container { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem; padding-bottom: 1rem; scroll-behavior: smooth; }

        .empty-state { display: flex; align-items: center; justify-content: center; height: 100%; text-align: center; }
        .empty-state-content h2 { font-size: 1.125rem; font-weight: 600; color: var(--foreground); margin-bottom: 0.5rem; }
        .empty-state-content p { font-size: 0.875rem; color: var(--muted-foreground); }

        .message { display: flex; margin-bottom: 1rem; }
        .message.user { justify-content: flex-end; }
        .message.assistant { justify-content: flex-start; }

        .message-content { max-width: 70%; display: flex; flex-direction: column; }
        .message-bubble { padding: 1rem; border-radius: 1rem; word-wrap: break-word; white-space: pre-wrap; line-height: 1.5; }
        .message.user .message-bubble { background-color: #000; border: 1px solid #fff; color: #fff; font-size: 0.875rem; }
        .message.assistant .message-bubble { background-color: var(--card); color: var(--foreground); font-size: 0.875rem; }

        /* Typing Indicator */
        .typing-indicator {
            display: flex; align-items: center; gap: 0.25rem; padding: 1rem; background-color: var(--card); border-radius: 1rem; width: fit-content;
        }
        .typing-dot {
            width: 0.5rem; height: 0.5rem; border-radius: 50%; background-color: var(--muted-foreground); animation: typing 1.4s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { opacity: 0.5; } 30% { opacity: 1; } }

        .input-area { display: flex; gap: 0.75rem; padding-top: 1rem; flex-shrink: 0; }
        textarea {
            flex: 1; background-color: var(--card); border: 1px solid var(--border); color: var(--foreground);
            padding: 0.75rem; border-radius: 0.5rem; font-family: inherit; font-size: 1rem; resize: none; min-height: 3rem; max-height: 12rem; overflow-y: auto;
        }
        .send-button { background-color: var(--primary); color: var(--foreground); border: none; padding: 0.75rem 1rem; border-radius: 0.5rem; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; transition: opacity 0.2s; }
        .send-button:hover { opacity: 0.9; }
        .send-button:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <h1>LumoAI</h1>
        </header>

        <main>
            <div class="messages-container" id="messagesContainer">
                <div class="empty-state">
                    <div class="empty-state-content">
                        <h2>Start a Conversation</h2>
                        <p>Type your message to start chat with Lumo</p>
                    </div>
                </div>
            </div>

            <div class="input-area">
                <textarea id="messageInput" placeholder="Type your message..." rows="3"></textarea>
                <button class="send-button" id="sendButton">Send</button>
            </div>
        </main>
    </div>

    <script>
        const apiBase = "https://lumoai-backend-b91o.onrender.com"; // Backend URL

        const messagesContainer = document.getElementById('messagesContainer');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        function addMessage(content, sender) {
            const messageEl = document.createElement('div');
            messageEl.className = 'message ' + sender;
            const contentEl = document.createElement('div');
            contentEl.className = 'message-content';
            contentEl.innerHTML = `<div class="message-bubble">${content}</div>`;
            messageEl.appendChild(contentEl);
            messagesContainer.appendChild(messageEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const typingEl = document.createElement('div');
            typingEl.className = 'message assistant';
            typingEl.id = 'typingIndicator';
            typingEl.innerHTML = `<div class="message-content"><div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>`;
            messagesContainer.appendChild(typingEl);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingEl = document.getElementById('typingIndicator');
            if (typingEl) typingEl.remove();
        }

        async function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            messageInput.value = '';

            showTypingIndicator();

            try {
                const res = await fetch(`${apiBase}/api/message`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                const data = await res.json();
                removeTypingIndicator();
                addMessage(data.reply, 'assistant');
            } catch (err) {
                removeTypingIndicator();
                addMessage('Error connecting to backend.', 'assistant');
                console.error(err);
            }
        }

        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
        });
    </script>
</body>
</html>
