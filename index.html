<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>LumoAI - Chat Application</title>
    <meta name="description" content="Anne - Just being myself" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300..800&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --background: hsl(0 0% 0%);
            --foreground: hsl(200 6.6667% 91.1765%);
            --card: hsl(228 9.8039% 10%);
            --border: hsl(210 5.2632% 14.9020%);
            --muted-foreground: hsl(210 3.3898% 46.2745%);
            --primary: hsl(203.77 87.6% 52.5%);
        }

        html, body {
            height: 100%;
            font-family: "Open Sans", sans-serif;
            background: var(--background);
            color: var(--foreground);
        }

        body { display: flex; flex-direction: column; }

        header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
        }

        .message.user { justify-content: flex-end; }
        .message.assistant { justify-content: flex-start; }

        .message-bubble {
            max-width: 70%;
            padding: 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .message.user .message-bubble {
            background: #000;
            border: 1px solid #fff;
            color: #fff;
        }

        .message.assistant .message-bubble {
            background: var(--card);
        }

        .typing-indicator {
            background: var(--card);
            padding: 1rem;
            border-radius: 1rem;
            display: flex;
            gap: 0.3rem;
        }

        .typing-dot {
            width: 0.5rem;
            height: 0.5rem;
            background: var(--muted-foreground);
            border-radius: 50%;
            animation: blink 1.4s infinite both;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes blink {
            0%, 80%, 100% { opacity: 0.3; }
            40% { opacity: 1; }
        }

        .input-area {
            display: flex;
            gap: 0.75rem;
            padding-top: 1rem;
        }

        textarea {
            flex: 1;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--foreground);
            padding: 0.75rem;
            border-radius: 0.5rem;
            resize: none;
            font-family: inherit;
        }

        button {
            background: var(--primary);
            border: none;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
        }
    </style>
</head>

<body>
<header>
    <h1>LumoAI</h1>
</header>

<main>
    <div class="messages-container" id="messagesContainer"></div>

    <div class="input-area">
        <textarea id="messageInput" rows="2" placeholder="Type your message..."></textarea>
        <button id="sendButton">Send</button>
    </div>
</main>

<script>
    // ✅ CORRECT BACKEND URL
    const apiBase = "https://lumo-replit.onrender.com";

    const messagesContainer = document.getElementById("messagesContainer");
    const messageInput = document.getElementById("messageInput");
    const sendButton = document.getElementById("sendButton");

    function addMessage(text, sender) {
        const msg = document.createElement("div");
        msg.className = "message " + sender;
        msg.innerHTML = `<div class="message-bubble">${text}</div>`;
        messagesContainer.appendChild(msg);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function showTyping() {
        const typing = document.createElement("div");
        typing.id = "typing";
        typing.className = "message assistant";
        typing.innerHTML = `
            <div class="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>`;
        messagesContainer.appendChild(typing);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function removeTyping() {
        const typing = document.getElementById("typing");
        if (typing) typing.remove();
    }

    async function sendMessage() {
        const text = messageInput.value.trim();
        if (!text) return;

        addMessage(text, "user");
        messageInput.value = "";
        showTyping();

        try {
            const res = await fetch(`${apiBase}/chat`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: text })
            });

            if (!res.ok) throw new Error("Backend error");

            const data = await res.json();
            removeTyping();
            addMessage(data.reply, "assistant");

        } catch (err) {
            removeTyping();
            addMessage("⚠️ Unable to connect to server.", "assistant");
            console.error(err);
        }
    }

    sendButton.addEventListener("click", sendMessage);
    messageInput.addEventListener("keydown", e => {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
</script>
</body>
</html>
